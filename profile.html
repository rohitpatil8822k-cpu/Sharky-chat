<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0, viewport-fit=cover" />
  <title>Sharky Pro | Profile</title>
  <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;700&family=Orbitron:wght@700;900&family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    :root {
      --primary: #00d4ff; --surface: #121826; --bg: #05070a;
      --border: rgba(255, 255, 255, 0.08); --text-main: #f1f5f9;
      --text-dim: #94a3b8; --gold: #fbbf24; --pro: #a855f7; --premium: #f43f5e;
    }

    * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
    
    body { 
      background-color: var(--bg); 
      color: var(--text-main); 
      font-family: 'Inter', sans-serif; 
      padding-top: 60px;
      overflow-x: hidden;
      transition: background 0.5s ease;
    }

    body.theme-basic { background: radial-gradient(circle at top, #0f172a 0%, #05070a 100%); }
    body.theme-pro { background: radial-gradient(circle at top, #1e1033 0%, #05070a 100%); }
    body.theme-premium { background: radial-gradient(circle at top, #2d0a0e 0%, #05070a 100%); }

    .app-container { width: 100%; max-width: 480px; margin: 0 auto; position: relative; padding-bottom: 120px; }
    
    .hero-section { position: relative; padding: 0 10px; margin-top: 10px; }
    .cover-wrapper { 
      width: 100%; height: 170px; background: #161b22; overflow: hidden; border-radius: 24px; 
      border: 1px solid var(--border); transition: 0.4s;
    }
    .theme-basic .cover-wrapper { border-color: var(--primary); }
    .theme-pro .cover-wrapper { border-color: var(--pro); box-shadow: 0 0 20px rgba(168, 85, 247, 0.2); }
    .theme-premium .cover-wrapper { border-color: var(--premium); box-shadow: 0 0 25px rgba(244, 63, 94, 0.25); }

    .cover-image { width: 100%; height: 100%; object-fit: cover; opacity: 0; transition: 0.8s; }
    .cover-image.loaded { opacity: 1; }
    
    .change-btn { position: absolute; top: 15px; right: 25px; z-index: 20; background: rgba(0,0,0,0.7); color: white; border: 1px solid rgba(255,255,255,0.2); padding: 8px 16px; border-radius: 12px; font-size: 0.75rem; backdrop-filter: blur(10px); cursor: pointer; }
    
    .profile-header { display: flex; flex-direction: column; align-items: center; margin-top: -55px; position: relative; z-index: 10; }
    .avatar-circle { width: 110px; height: 110px; border-radius: 35px; border: 5px solid var(--bg); background-size: cover; background-position: center; position: relative; cursor: pointer; background-color: #1a1a1a; transition: 0.5s; }
    .avatar-circle::after { content: "\f030"; font-family: "Font Awesome 6 Free"; font-weight: 900; position: absolute; bottom: 5px; right: 5px; background: var(--primary); color: #000; width: 28px; height: 28px; border-radius: 10px; display: flex; align-items: center; justify-content: center; font-size: 0.7rem; border: 3px solid var(--bg); }
    
    .name-bubble { display: flex; align-items: center; gap: 10px; margin-top: 15px; background: rgba(255, 255, 255, 0.05); padding: 10px 22px; border-radius: 50px; border: 1px solid var(--border); backdrop-filter: blur(10px); }
    #username { font-size: 1.2rem; font-weight: 700; font-family: 'Orbitron', sans-serif; }
    
    .badges-container { display: flex; gap: 5px; }
    .equipped-badge-img { width: 24px; height: 24px; object-fit: contain; display: none; }
    
    .membership-card { background: rgba(255, 255, 255, 0.03); border: 1px solid var(--border); border-radius: 24px; padding: 18px 22px; margin: 25px 15px; display: flex; justify-content: space-between; align-items: center; position: relative; overflow: hidden; }
    .membership-card::before { content: ''; position: absolute; top: 0; left: 0; width: 4px; height: 100%; background: var(--gold); }
    .status-box h4 { font-size: 0.65rem; color: var(--text-dim); font-weight: 800; font-family: 'Orbitron', sans-serif; margin-bottom: 2px; }
    #planLabel { font-weight: 900; font-size: 1.1rem; color: #fff; text-shadow: 0 0 10px rgba(255,255,255,0.2); }
    .upgrade-btn { background: var(--gold); color: #000; border: none; padding: 12px 20px; border-radius: 14px; font-weight: 900; font-size: 0.8rem; font-family: 'Orbitron', sans-serif; cursor: pointer; transition: 0.3s; }
    .upgrade-btn:active { transform: scale(0.95); }
    
    .card { background: var(--surface); border: 1px solid var(--border); border-radius: 28px; padding: 24px; margin: 0 15px 20px; transition: 0.4s; }
    .card-title { font-size: 0.75rem; font-weight: 800; color: var(--primary); text-transform: uppercase; letter-spacing: 2px; margin-bottom: 20px; display: flex; align-items: center; gap: 10px; font-family: 'Orbitron', sans-serif; }
    
    .grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
    label { font-size: 0.68rem; color: var(--text-dim); font-weight: 800; display: block; margin-bottom: 6px; font-family: 'Orbitron', sans-serif; }
    
    input, select, textarea { width: 100%; background: rgba(0,0,0,0.3); border: 1px solid var(--border); border-radius: 16px; padding: 15px; color: white; margin-bottom: 15px; outline: none; font-family: 'Inter', sans-serif; transition: 0.3s; }
    input:focus { border-color: var(--primary); background: rgba(0,0,0,0.5); }
    
    .color-grid { display: grid; grid-template-columns: repeat(6, 1fr); gap: 10px; }
    .color-box { 
      width: 100%; aspect-ratio: 1/1; border-radius: 14px; cursor: pointer; border: 2px solid transparent; 
      display: flex; align-items: center; justify-content: center; position: relative; overflow: hidden; 
    }
    .color-box.selected { border-color: #fff; transform: scale(1.1); box-shadow: 0 0 15px rgba(255,255,255,0.3); }
    .lock-overlay { position: absolute; inset: 0; background: rgba(0,0,0,0.6); display: flex; align-items: center; justify-content: center; color: rgba(255,255,255,0.7); font-size: 0.7rem; }
    
    .sec-btn { width: 100%; background: rgba(255, 255, 255, 0.04); color: white; border: 1px solid var(--border); padding: 18px; border-radius: 18px; font-size: 0.95rem; margin-bottom: 12px; text-align: left; display: flex; align-items: center; gap: 14px; font-weight: 600; cursor: pointer; transition: 0.3s; }
    .sec-btn:hover { background: rgba(255, 255, 255, 0.08); }
    .btn-danger { color: #ff4b4b; background: rgba(255, 75, 75, 0.08); border-color: rgba(255, 75, 75, 0.2); }
    
    .bottom-bar { position: fixed; bottom: 0; width: 100%; max-width: 480px; padding: 25px; background: linear-gradient(transparent, var(--bg) 60%); z-index: 1000; left: 50%; transform: translateX(-50%); }
    .save-btn { width: 100%; background: var(--primary); color: #000; border: none; padding: 20px; border-radius: 24px; font-weight: 900; font-size: 1.1rem; font-family: 'Orbitron', sans-serif; box-shadow: 0 10px 30px rgba(0,212,255,0.4); cursor: pointer; }
    
    .modal { 
      position: fixed; inset: 0; background: rgba(0,0,0,0.85); backdrop-filter: blur(10px); 
      display: none; align-items: center; justify-content: center; z-index: 11000; padding: 20px; 
    }
    .modal-content { 
      background: #121826; border: 1px solid var(--gold); border-radius: 30px; padding: 35px; 
      width: 100%; max-width: 380px; text-align: center; box-shadow: 0 20px 50px rgba(0,0,0,0.5);
    }
    .modal-content h2 { font-family: 'Orbitron', sans-serif; color: var(--gold); margin-bottom: 15px; font-size: 1.3rem; }
    .modal-content p { color: var(--text-dim); margin-bottom: 25px; line-height: 1.5; font-size: 0.95rem; }
    .modal-btns { display: flex; gap: 12px; }
    .m-btn { flex: 1; padding: 15px; border-radius: 16px; font-weight: 800; font-family: 'Orbitron', sans-serif; cursor: pointer; border: none; }
    .btn-buy { background: var(--gold); color: #000; }
    .btn-cancel { background: rgba(255,255,255,0.05); color: #fff; }

    #savePopup { position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: #121826; padding: 35px; border-radius: 30px; border: 1px solid var(--primary); z-index: 12000; text-align: center; display: none; box-shadow: 0 0 60px rgba(0,0,0,0.9); }
  </style>
</head>
<body>

  <script src="header.js"></script>

  <div class="modal" id="upgradeModal">
    <div class="modal-content">
      <h2>UNLOCK PREMIUM</h2>
      <p>This feature is exclusive to our Premium & Pro members. Ready to level up your profile?</p>
      <div class="modal-btns">
        <button class="m-btn btn-cancel" onclick="closeModal()">CANCEL</button>
        <button class="m-btn btn-buy" onclick="location.href='membership.html'">UPGRADE</button>
      </div>
    </div>
  </div>

  <div id="savePopup">
    <div style="font-size: 3rem; color: #2ed573; margin-bottom: 12px;"><i class="fa-solid fa-circle-check"></i></div>
    <div style="color: #fff; font-weight: 900; font-family: 'Orbitron', sans-serif; letter-spacing: 1px;">PROFILE SYNCED</div>
  </div>

  <div class="app-container">
    <section class="hero-section">
      <button class="change-btn" onclick="location.href='inventory.html'">Change Banner</button>
      <div class="cover-wrapper"><img class="cover-image" id="profileBannerImg"></div>
      <div class="profile-header">
        <div class="avatar-circle" id="profilePic" onclick="location.href='gallery.html'"></div>
        <div class="name-bubble">
          <span id="username">Guest</span>
          <div class="badges-container">
            <img id="badge1" class="equipped-badge-img">
            <img id="badge2" class="equipped-badge-img">
            <img id="badge3" class="equipped-badge-img">
          </div>
        </div>
      </div>
    </section>

    <div class="membership-card">
        <div class="status-box">
            <h4>ACCOUNT TYPE</h4>
            <div id="planLabel">FREE</div>
        </div>
        <button class="upgrade-btn" id="planActionBtn">UPGRADE</button>
    </div>

    <div class="card">
        <div class="card-title"><i class="fa-solid fa-user-pen"></i> Personal Details</div>
        <div class="grid-2">
            <div><label>AGE</label><input type="number" id="age" placeholder="--"></div>
            <div><label>GENDER</label><select id="gender"><option>Male</option><option>Female</option><option>Other</option></select></div>
        </div>
        <div class="grid-2">
            <div><label>COUNTRY</label><input type="text" id="country" readonly></div>
            <div><label>STATE</label><input type="text" id="state" placeholder="State"></div>
        </div>
        <label>CITY</label><input type="text" id="city" placeholder="City">
        <div class="grid-2">
            <div><label>HEIGHT (CM)</label><input type="number" id="height" placeholder="170"></div>
            <div><label>WEIGHT (KG)</label><input type="number" id="weight" placeholder="60"></div>
        </div>
        <label>BIO SYNOPSIS</label><textarea id="bio" rows="2" placeholder="Tell us about yourself..."></textarea>
    </div>

    <div class="card">
        <div class="card-title" style="color:var(--gold);"><i class="fa-solid fa-crown"></i> VIP Name Signatures</div>
        <div class="color-grid" id="vipSignatureGrid"></div>
    </div>

    <div class="card">
        <div class="card-title"><i class="fa-solid fa-palette"></i> Standard Colors</div>
        <div class="color-grid" id="basicSignatureGrid"></div>
    </div>

    <div class="card">
        <div class="card-title" style="color:var(--gold);"><i class="fa-solid fa-message"></i> Premium Chat Tint</div>
        <div class="color-grid" id="vipMessageGrid"></div>
    </div>

    <div class="card">
        <div class="card-title"><i class="fa-solid fa-shield-halved"></i> Security & Session</div>
        <button class="sec-btn" onclick="location.href='change-email.html'"><i class="fa-solid fa-envelope"></i> Change Email</button>
        <button class="sec-btn" onclick="location.href='change-password.html'"><i class="fa-solid fa-lock"></i> Change Password</button>
        <button class="sec-btn btn-danger" onclick="deleteAccount()"><i class="fa-solid fa-trash-can"></i> Delete Account</button>
        <button class="sec-btn" style="background:transparent; border:none; justify-content:center; opacity:0.5;" onclick="logout()"><i class="fa-solid fa-door-open"></i> Logout Session</button>
    </div>

    <div class="bottom-bar"><button class="save-btn" onclick="saveProfile()">SAVE CHANGES</button></div>
  </div>

  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyBGfgy9OeMTJ__oOAFxoBW-eIOYlvhObZM",
      authDomain: "sharky-chat-007.firebaseapp.com",
      projectId: "sharky-chat-007",
      storageBucket: "sharky-chat-007.appspot.com",
      messagingSenderId: "637104796242",
      appId: "1:637104796242:web:74ac36b86af91be15ea58b"
    };

    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();

    const itemsMeta = {
      banner: {
        "banner_stars_profile": "https://user-gen-media-assets.s3.amazonaws.com/gpt4o_images/94c0fcfa-2a7a-46f1-ad8d-9ae08a932228.png", 
        "banner_cute_rabbit": "https://user-gen-media-assets.s3.amazonaws.com/gpt4o_images/c4c60231-2b74-427d-8037-98f1b33227f1.png",
        "banner_peaceful_house_3d": "https://user-gen-media-assets.s3.amazonaws.com/gpt4o_images/3baf3830-1a64-425c-bd6f-905bacbc84ad.png",
        "banner_4d_illusion": "https://user-gen-media-assets.s3.amazonaws.com/gpt4o_images/0704da65-dc4f-4ece-adbc-cd598182010c.png",
        "banner_3d_luxury": "https://user-gen-media-assets.s3.amazonaws.com/gpt4o_images/5d228e0c-1e37-4101-90e4-28313586a6af.png",
        "banner_3d_moon": "https://user-gen-media-assets.s3.amazonaws.com/gpt4o_images/d185a9a8-660f-4396-9925-b3760299e111.png",
        "banner_3d_gaming": "https://user-gen-media-assets.s3.amazonaws.com/gpt4o_images/86b48c74-56b9-4e3d-b82c-4be753dd9234.png",
        "banner_cartoon_one_eyed_devil": "https://user-gen-media-assets.s3.amazonaws.com/gpt4o_images/c33cf83a-151b-4f56-ad81-5b2f2c4b9164.png",
        "banner_bmw_headlight_evil": "https://user-gen-media-assets.s3.amazonaws.com/gpt4o_images/e3a07e8f-23af-42d5-9a5d-03f4f768ec76.png",
        "banner_cartoon_turtle": "https://user-gen-media-assets.s3.amazonaws.com/gpt4o_images/73c882c5-e531-4b01-a356-75fdc5e4f822.png",
        "banner_3d_rain": "https://user-gen-media-assets.s3.amazonaws.com/gpt4o_images/09250fbd-e0a9-4861-9251-8033325be157.png"
      },
      badge: {
        "badge_star_light": "https://user-gen-media-assets.s3.amazonaws.com/gpt4o_images/cb7afe60-1c8e-4af6-8780-01856f63b51d.png",
        "badge_moon_dark": "https://user-gen-media-assets.s3.amazonaws.com/gpt4o_images/60a43f65-1ab7-4923-8788-758778130a22.png",
        "badge_rising_star": "https://user-gen-media-assets.s3.amazonaws.com/gpt4o_images/43fb251c-b5e8-4541-a786-d91e060eb7f0.png",
        "badge_luxury": "https://user-gen-media-assets.s3.amazonaws.com/gpt4o_images/23b9ac5c-faaf-4d14-ad52-65aab320e878.png",
        "badge_legendary": "https://user-gen-media-assets.s3.amazonaws.com/gpt4o_images/85b7077f-5e80-42e1-890f-ec78df6afd0e.png",
        "badge_warrior": "https://user-gen-media-assets.s3.amazonaws.com/gpt4o_images/8315ccb8-4f68-4dc9-b1c9-225b62ed2a87.png",
        "badge_wolf": "https://user-gen-media-assets.s3.amazonaws.com/gpt4o_images/94674004-81f1-4aa5-afe2-15c097b29a76.png",
        "badge_lion": "https://user-gen-media-assets.s3.amazonaws.com/gpt4o_images/f026bd24-7f5b-44d8-9312-a190d6d30933.png",
        "badge_king": "https://user-gen-media-assets.s3.amazonaws.com/gpt4o_images/a07d8670-6f91-43b1-884e-79a347c3fda0.png"
      }
    };

    const basicColors = ['#f87171','#fbbf24','#34d399','#60a5fa','#a78bfa','#f472b6','#fb923c','#4ade80','#c084fc','#38d214','#facc15','#94a3b8'];
    const vipGradients = [
        'linear-gradient(45deg, #FFD700, #B8860B)', 
        'linear-gradient(45deg, #00C9FF, #92FE9D)', 
        'linear-gradient(45deg, #FF0080, #7928CA)', 
        'linear-gradient(45deg, #12c2e9, #c471ed, #f64f59)', 
        'linear-gradient(45deg, #fc00ff, #00dbde)', 
        'linear-gradient(45deg, #2af598, #009efd)', 
        'linear-gradient(135deg, #667eea, #764ba2)', 
        'linear-gradient(135deg, #f093fb, #f5576c)', 
        'linear-gradient(45deg, #3f0d12, #a71d31)', 
        'linear-gradient(45deg, #13315c, #0d1b2a)', 
        'linear-gradient(45deg, #8E2DE2, #4A00E0)', 
        'linear-gradient(45deg, #f85032, #e73827)'
    ];

    let currentUserUid, currentPlan = "free", selSig = "#ffffff", selMsg = "#0084ff";

    auth.onAuthStateChanged(async user => {
        if(!user) { location.href="login.html"; return; }
        currentUserUid = user.uid;
        const uSnap = await db.collection("users").doc(currentUserUid).get();
        if(!uSnap.exists) return;
        const d = uSnap.data();
        
        currentPlan = (d.membershipPlan || "free").toLowerCase();
        applyTheme(currentPlan);
        
        const actionBtn = document.getElementById("planActionBtn");
        document.getElementById("planLabel").textContent = currentPlan.toUpperCase();
        actionBtn.textContent = currentPlan === "free" ? "UPGRADE" : "MANAGE PLAN";
        actionBtn.onclick = () => location.href="membership.html";
        
        document.getElementById("username").textContent = d.username;
        document.getElementById("age").value = d.age || "";
        document.getElementById("city").value = d.city || "";
        document.getElementById("state").value = d.state || "";
        document.getElementById("height").value = d.height || "";
        document.getElementById("weight").value = d.weight || "";
        document.getElementById("bio").value = d.bio || "";
        document.getElementById("gender").value = d.gender || "Male";
        
        selSig = d.usernameColor || "#ffffff";
        selMsg = d.messageColor || "#0084ff";

        if(d.profilePic) document.getElementById("profilePic").style.backgroundImage = `url('${d.profilePic}')`;
        fetch('https://ipapi.co/json/').then(r=>r.json()).then(loc => {
            document.getElementById("country").value = loc.country_name || "Unknown";
        });

        const eqSnap = await db.collection("equipped").doc(currentUserUid).get();
        if (eqSnap.exists) {
            const eq = eqSnap.data();
            if (eq.banner) { 
                const bi = document.getElementById("profileBannerImg"); 
                bi.src = itemsMeta.banner[eq.banner]; 
                bi.onload = () => bi.classList.add('loaded'); 
            }
            const maxBadges = currentPlan === "premium" ? 3 : (currentPlan === "pro" ? 2 : 1);
            for(let i=1; i<=3; i++) {
                let bid = eq[`badge${i}`];
                if(bid && i <= maxBadges) { 
                    const img = document.getElementById(`badge${i}`); 
                    img.src = itemsMeta.badge[bid]; 
                    img.style.display="block"; 
                }
            }
        }
        renderGrids();
        applySignatureStyle();
    });

    function applyTheme(plan) {
        document.body.className = `theme-${plan}`;
    }

    function renderGrids() {
        const vGrid = document.getElementById("vipSignatureGrid"); vGrid.innerHTML = "";
        vipGradients.forEach(g => {
            const box = document.createElement("div"); 
            box.className = `color-box ${selSig === g ? 'selected' : ''}`; 
            box.style.background = g;
            if(currentPlan === "free" || currentPlan === "basic") { 
                box.innerHTML = '<div class="lock-overlay"><i class="fa-solid fa-lock"></i></div>'; 
                box.onclick = () => openModal(); 
            } else { 
                box.onclick = () => { selSig = g; applySignatureStyle(); renderGrids(); }; 
            }
            vGrid.appendChild(box);
        });

        const bGrid = document.getElementById("basicSignatureGrid"); bGrid.innerHTML = "";
        basicColors.forEach(c => {
            const box = document.createElement("div"); 
            box.className = `color-box ${selSig === c ? 'selected' : ''}`; 
            box.style.backgroundColor = c;
            box.onclick = () => { selSig = c; applySignatureStyle(); renderGrids(); };
            bGrid.appendChild(box);
        });

        const mGrid = document.getElementById("vipMessageGrid"); mGrid.innerHTML = "";
        const allColors = [...vipGradients, ...basicColors];
        allColors.forEach(c => {
            const box = document.createElement("div"); 
            box.className = `color-box ${selMsg === c ? 'selected' : ''}`;
            box.style.background = c; 
            
            let isLocked = false;
            if(c.includes('gradient') && currentPlan !== 'premium') isLocked = true;
            if(!c.includes('gradient') && currentPlan === 'free') isLocked = true;

            if(isLocked) {
                box.innerHTML = '<div class="lock-overlay"><i class="fa-solid fa-lock"></i></div>';
                box.onclick = () => openModal();
            } else {
                box.onclick = () => { selMsg = c; renderGrids(); };
            }
            mGrid.appendChild(box);
        });
    }

    function applySignatureStyle() {
        const u = document.getElementById("username");
        if(selSig.includes("gradient")) { 
            u.style.background = selSig; 
            u.style.webkitBackgroundClip = "text"; 
            u.style.webkitTextFillColor = "transparent"; 
        } else { 
            u.style.background = "none"; 
            u.style.webkitTextFillColor = "initial"; 
            u.style.color = selSig; 
        }
    }

    window.openModal = () => document.getElementById("upgradeModal").style.display = "flex";
    window.closeModal = () => document.getElementById("upgradeModal").style.display = "none";

    window.saveProfile = async () => {
        const pop = document.getElementById("savePopup");
        pop.style.display = "block";
        try {
            await db.collection("users").doc(currentUserUid).update({
                age: document.getElementById("age").value,
                city: document.getElementById("city").value,
                state: document.getElementById("state").value,
                height: document.getElementById("height").value,
                weight: document.getElementById("weight").value,
                gender: document.getElementById("gender").value,
                bio: document.getElementById("bio").value,
                usernameColor: selSig, 
                messageColor: selMsg
            });
            setTimeout(() => { pop.style.display = "none"; }, 1500);
        } catch (err) {
            pop.style.display = "none";
            alert("Error: " + err.message);
        }
    };

    window.logout = () => auth.signOut().then(() => location.href="login.html");
    window.deleteAccount = () => { if(confirm("Contact Admin for deletion.")) { } };
  </script>
</body>
</html>