<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Sharky Luxe Wallet</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700;800&family=IBM+Plex+Mono:wght@500&display=swap" rel="stylesheet" />
  <script src="https://unpkg.com/lucide@latest"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
  <style>
    :root {
      --primary: #00e5ff; --gold: #ffc107; --bg: #080a0c;
      --card-bg: rgba(255, 255, 255, 0.04); --border: rgba(255, 255, 255, 0.08);
      --text-main: #ffffff; --text-dim: #8e9196;
    }
    * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; outline: none; }
    body { margin: 0; padding: 0; background: var(--bg); color: var(--text-main); font-family: 'Outfit', sans-serif; min-height: 100vh; }
    .app-container { padding: 80px 20px 100px; max-width: 450px; margin: 0 auto; }
    .stat-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 20px; }
    .stat-card { background: var(--card-bg); border: 1px solid var(--border); border-radius: 28px; padding: 20px; display: flex; flex-direction: column; align-items: center; backdrop-filter: blur(10px); }
    .coin-circle { width: 65px; height: 65px; border-radius: 50%; background: rgba(255,255,255,0.03); border: 2px solid var(--border); display: flex; align-items: center; justify-content: center; margin-bottom: 12px; overflow: hidden; box-shadow: 0 0 15px rgba(0,0,0,0.3); }
    .coin-circle img { width: 100%; height: 100%; object-fit: cover; }
    .stat-card b { font-size: 1.4rem; font-weight: 700; }
    .stat-card span { font-size: 0.6rem; color: var(--text-dim); font-weight: 800; letter-spacing: 1px; }
    .balance-bar { background: linear-gradient(135deg, rgba(255,255,255,0.05), transparent); border: 1px solid var(--border); border-radius: 30px; padding: 20px 25px; display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px; }
    .balance-bar h2 { font-family: 'IBM Plex Mono'; font-size: 1.8rem; margin: 5px 0 0; }
    .btn-add { background: #fff; color: #000; width: 45px; height: 45px; border-radius: 50%; display: flex; align-items: center; justify-content: center; cursor: pointer; }
    .action-group { display: flex; gap: 12px; margin-bottom: 30px; }
    .action-btn { flex: 1; background: var(--card-bg); border: 1px solid var(--border); border-radius: 20px; padding: 15px; display: flex; flex-direction: column; align-items: center; gap: 8px; font-weight: 600; font-size: 0.8rem; transition: 0.2s; position: relative; }
    .action-btn:active { transform: scale(0.95); }
    .dot { position: absolute; top: 12px; right: 35%; width: 8px; height: 8px; background: #ff4757; border-radius: 50%; display: none; box-shadow: 0 0 8px #ff4757; }
    .section-header-flex { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; }
    .section-title { font-size: 0.8rem; font-weight: 800; color: var(--text-dim); letter-spacing: 1.5px; text-transform: uppercase; }
    .countdown-timer { font-size: 0.75rem; font-weight: 600; color: var(--primary); background: rgba(0, 229, 255, 0.1); padding: 4px 10px; border-radius: 8px; display: none; }
    .mission-card, .gift-item { background: var(--card-bg); border: 1px solid var(--border); border-radius: 24px; padding: 16px 20px; display: flex; align-items: center; justify-content: space-between; margin-bottom: 12px; }
    .claim-btn { background: var(--primary); color: #000; border: none; padding: 10px 18px; border-radius: 14px; font-weight: 800; font-size: 0.75rem; cursor: pointer; transition: 0.3s; }
    .claim-btn:disabled { background: #1e2226; color: #4e545a; cursor: not-allowed; }
    .search-row { display: flex; align-items: center; gap: 12px; padding: 12px; cursor: pointer; border-bottom: 1px solid rgba(255,255,255,0.05); }
    .search-row img { width: 35px; height: 35px; border-radius: 50%; object-fit: cover; }
    .modal-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.85); backdrop-filter: blur(10px); display: none; align-items: center; justify-content: center; z-index: 2000; padding: 20px; }
    .modal-box { background: #0f1115; border: 1px solid var(--border); width: 100%; max-width: 400px; border-radius: 32px; padding: 25px; animation: pop 0.3s ease; }
    @keyframes pop { from { transform: scale(0.9); opacity: 0; } to { transform: scale(1); opacity: 1; } }
    .input-field { width: 100%; background: #000; border: 1px solid var(--border); padding: 14px; border-radius: 16px; color: #fff; margin-bottom: 12px; font-family: inherit; }
    #reward-pop { position: fixed; inset: 0; background: rgba(0,0,0,0.95); z-index: 5000; display: none; flex-direction: column; align-items: center; justify-content: center; text-align: center; }
    #sw-toast { position: fixed; bottom: 30px; left: 50%; transform: translateX(-50%); background: #fff; color: #000; padding: 12px 25px; border-radius: 50px; font-weight: 700; z-index: 6000; display: none; }
  </style>
</head>
<body>
  <script src="header.js"></script>
  <div class="app-container">
    <div class="stat-grid">
      <div class="stat-card">
        <div class="coin-circle"><img src="https://user-gen-media-assets.s3.amazonaws.com/gpt4o_images/2fcd666d-0c17-4861-bd36-3f7ff94e242c.png"></div>
        <b id="cCount">0</b>
        <span>SHARKY COINS</span>
      </div>
      <div class="stat-card">
        <div class="coin-circle"><img src="https://user-gen-media-assets.s3.amazonaws.com/gpt4o_images/7b852f75-8330-4a86-8c7c-f528de84c4de.png"></div>
        <b id="gCount">0</b>
        <span>SHARKY GOLD</span>
      </div>
    </div>
    <div class="balance-bar">
      <div class="info">
        <span style="font-size: 0.7rem; color: var(--text-dim); font-weight: 700; text-transform: uppercase;">Verified Balance</span>
        <h2 id="mCount">‚Çπ0</h2>
      </div>
      <div class="btn-add" onclick="location.href='add-money.html'"><i data-lucide="plus" size="24"></i></div>
    </div>
    <div class="action-group">
      <div class="action-btn" onclick="openM('giftM')"><i data-lucide="send" color="var(--primary)"></i>Send</div>
      <div class="action-btn" onclick="openM('inboxM')"><i data-lucide="mail" color="#ff4757"></i>Inbox<div class="dot" id="inbox-dot"></div></div>
      <div class="action-btn" onclick="location.href='market.html'"><i data-lucide="shopping-bag" color="var(--gold)"></i>Market</div>
    </div>
    <div class="section-header-flex">
      <div class="section-title">Daily Milestones</div>
      <div id="next-reward-timer" class="countdown-timer">Next in: 00:00:00</div>
    </div>
    <div id="mission-container"></div>
  </div>
  <div id="giftM" class="modal-overlay" onclick="closeM(event, 'giftM')">
    <div class="modal-box">
      <h3 style="margin:0 0 20px">Send a Gift</h3>
      <input type="text" id="userSearch" class="input-field" placeholder="Search user..." oninput="searchUsers(this.value)">
      <div id="search-results" style="background:#000; border-radius:18px; display:none; border:1px solid var(--border); margin-bottom:15px; max-height:200px; overflow-y:auto"></div>
      <select id="giftType" class="input-field"><option value="sharkyCoin">Sharky Coin</option><option value="sharkyGold">Sharky Gold</option></select>
      <input type="number" id="giftAmt" class="input-field" placeholder="Amount">
      <button class="claim-btn" id="sendBtn" style="width:100%; padding:18px">SEND NOW</button>
    </div>
  </div>
  <div id="inboxM" class="modal-overlay" onclick="closeM(event, 'inboxM')">
    <div class="modal-box">
      <h3 style="margin:0 0 20px">Your Inbox</h3>
      <div id="inbox-items" style="max-height:350px; overflow-y:auto"></div>
    </div>
  </div>
  <div id="reward-pop">
    <div style="font-size:5rem">üéÅ</div>
    <h1 style="margin:20px 0 10px">REWARD CLAIMED!</h1>
    <p id="reward-val" style="font-size:1.5rem; font-weight:700; color:var(--primary)"></p>
    <button class="claim-btn" onclick="document.getElementById('reward-pop').style.display='none'" style="padding:15px 40px; margin-top:30px">AWESOME</button>
  </div>
  <div id="sw-toast">Toast Message</div>
  <script>
    const firebaseConfig = {
        apiKey: "AIzaSyBGfgy9OeMTJ__oOAFxoBW-eIOYlvhObZM",
        authDomain: "sharky-chat-007.firebaseapp.com",
        projectId: "sharky-chat-007",
        storageBucket: "sharky-chat-007.appspot.com",
        messagingSenderId: "637104796242",
        appId: "1:637104796242:web:74ac36b86af91be15ea58b"
    };
    if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth(), db = firebase.firestore();
    let myUid = "", myUser = "", selectedTarget = "";
    const today = new Date().toISOString().split('T')[0];
    lucide.createIcons();
    function showT(m) {
      const t = document.getElementById('sw-toast');
      t.innerText = m; t.style.display = 'block';
      setTimeout(() => t.style.display = 'none', 2500);
    }
    window.openM = (id) => document.getElementById(id).style.display = 'flex';
    window.closeM = (e, id) => { if(e.target.id === id) document.getElementById(id).style.display = 'none'; };
    window.searchUsers = (v) => {
      const res = document.getElementById('search-results');
      if(v.length < 2) { res.style.display = 'none'; return; }
      db.collection("users").where("username", ">=", v).where("username", "<=", v + '\uf8ff').limit(5).get().then(snap => {
        res.innerHTML = ""; res.style.display = "block";
        snap.forEach(d => {
          if(d.id === myUid) return;
          const u = d.data();
          const div = document.createElement('div');
          div.className = "search-row";
          div.innerHTML = `<img src="${u.profilePic || 'https://via.placeholder.com/150'}" style="width:35px;height:35px;border-radius:50%;object-fit:cover;"> <span>${u.username}</span>`;
          div.onclick = () => { selectedTarget = d.id; document.getElementById('userSearch').value = u.username; res.style.display="none"; };
          res.appendChild(div);
        });
      });
    };
    function updateCountdown() {
      const now = new Date();
      const nextDay = new Date();
      nextDay.setHours(24, 0, 0, 0);
      const diff = nextDay - now;
      const h = Math.floor(diff / 3600000).toString().padStart(2, '0');
      const m = Math.floor((diff % 3600000) / 60000).toString().padStart(2, '0');
      const s = Math.floor((diff % 60000) / 1000).toString().padStart(2, '0');
      const timerDisplay = document.getElementById('next-reward-timer');
      timerDisplay.innerText = `Next in: ${h}:${m}:${s}`;
      timerDisplay.style.display = 'block';
    }
    setInterval(updateCountdown, 1000);
    async function handleClaim(day, type, val) {
      const btn = event.target; btn.disabled = true;
      try {
        await db.runTransaction(async (transaction) => {
          transaction.update(db.collection("wallets").doc(myUid), { [type]: firebase.firestore.FieldValue.increment(val) });
          transaction.set(db.collection("missions").doc(myUid), { lastClaim: today }, { merge: true });
        });
        document.getElementById('reward-val').innerText = `+${val} ${type === 'sharkyCoin' ? 'Coins' : 'Gold'}`;
        document.getElementById('reward-pop').style.display = 'flex';
        checkGlobalNotify();
      } catch(e) { alert("Claim failed."); btn.disabled = false; }
    }
    async function collectGift(id, type, amt) {
      try {
        await db.runTransaction(async (transaction) => {
          transaction.update(db.collection("wallets").doc(myUid), { [type]: firebase.firestore.FieldValue.increment(amt) });
          transaction.delete(db.collection("gifts").doc(id));
        });
        showT("Gift Collected!");
        checkGlobalNotify();
      } catch(e) { alert("Failed to collect"); }
    }
    document.getElementById('sendBtn').onclick = async () => {
      const amt = parseInt(document.getElementById('giftAmt').value);
      const type = document.getElementById('giftType').value;
      if(!selectedTarget || isNaN(amt) || amt <= 0) return alert("Invalid details");
      const btn = document.getElementById('sendBtn');
      btn.disabled = true;
      try {
        await db.runTransaction(async (transaction) => {
          const w = await transaction.get(db.collection("wallets").doc(myUid));
          if(w.data()[type] < amt) throw "Low Balance";
          transaction.update(db.collection("wallets").doc(myUid), { [type]: firebase.firestore.FieldValue.increment(-amt) });
          transaction.set(db.collection("gifts").doc(), { fromUid: myUid, fromName: myUser, toUid: selectedTarget, amount: amt, type: type, ts: Date.now() });
        });
        document.getElementById('giftM').style.display = 'none';
        showT("Gift Sent!");
      } catch(e) { alert(e); } finally { btn.disabled = false; }
    };
    function checkGlobalNotify() {
      const gifts = document.querySelectorAll('.gift-item').length;
      const claimable = document.querySelector('.claim-btn:not(:disabled):not(#sendBtn)');
      document.getElementById('inbox-dot').style.display = gifts > 0 ? 'block' : 'none';
      const hDot = document.querySelector('.header-notification-dot');
      if(hDot) hDot.style.display = (gifts > 0 || claimable) ? 'block' : 'none';
    }
    auth.onAuthStateChanged(async user => {
      if(!user) return;
      myUid = user.uid;
      const uDoc = await db.collection("users").doc(myUid).get();
      myUser = uDoc.data().username;
      db.collection("wallets").doc(myUid).onSnapshot(doc => {
        const d = doc.data() || { sharkyCoin:0, sharkyGold:0, realMoney:0 };
        document.getElementById('cCount').innerText = d.sharkyCoin.toLocaleString();
        document.getElementById('gCount').innerText = d.sharkyGold.toLocaleString();
        document.getElementById('mCount').innerText = "‚Çπ" + d.realMoney.toLocaleString();
        checkGlobalNotify();
      });
      const sDoc = await db.collection("streaks").doc(myUid).get();
      let stk = 1;
      if(sDoc.exists) {
        const d = sDoc.data();
        const yest = new Date(Date.now()-86400000).toISOString().split('T')[0];
        if(d.lastLogin === today) stk = d.count;
        else if(d.lastLogin === yest) stk = (d.count >= 10) ? 1 : d.count + 1;
      }
      await db.collection("streaks").doc(myUid).set({ count: stk, lastLogin: today }, { merge: true });
      db.collection("missions").doc(myUid).onSnapshot(mDoc => {
        const isClaimed = mDoc.exists && mDoc.data().lastClaim === today;
        const list = document.getElementById('mission-container');
        list.innerHTML = "";
        for(let i=1; i<=10; i++) {
          const active = (stk === i && !isClaimed);
          const done = (stk > i || (stk === i && isClaimed));
          const rewardType = i === 10 ? 'sharkyGold' : 'sharkyCoin';
          const rewardVal = i === 10 ? 1 : i;
          list.innerHTML += `<div class="mission-card" style="${active ? 'border-color:var(--primary)' : ''}">
            <div><div style="font-weight:700">Day ${i} Reward</div><div style="font-size:0.75rem; color:var(--primary); font-weight:800">+${rewardVal} ${i===10?'Gold':'Coins'}</div></div>
            <button class="claim-btn" ${!active?'disabled':''} onclick="handleClaim(${i},'${rewardType}',${rewardVal})">${done ? 'DONE' : 'CLAIM'}</button>
          </div>`;
        }
        checkGlobalNotify();
      });
      db.collection("gifts").where("toUid", "==", myUid).onSnapshot(sn => {
        const box = document.getElementById('inbox-items');
        box.innerHTML = sn.empty ? "<p style='text-align:center;color:gray'>No gifts</p>" : "";
        sn.forEach(d => {
          const g = d.data();
          box.innerHTML += `<div class="gift-item"><div><div style="font-weight:700;font-size:0.9rem">${g.fromName}</div><div style="color:var(--primary);font-weight:800">+${g.amount} ${g.type.replace('sharky','')}</div></div>
            <button class="claim-btn" style="padding:8px 15px" onclick="collectGift('${d.id}','${g.type}',${g.amount})">COLLECT</button></div>`;
        });
        checkGlobalNotify();
      });
    });
  </script>
</body>
</html>