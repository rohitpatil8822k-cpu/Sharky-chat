<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Sharky Chat — Social Media</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0,user-scalable=no" />
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6924983412433035"
     crossorigin="anonymous"></script>
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@700&family=Roboto:wght@400;500;700&family=Poppins:wght@600;700&family=Inter:wght@400;600&display=swap" rel="stylesheet"/>

  <style>
    * {
      box-sizing: border-box;
    }
    body {
      margin: 0;
      font-family: "Poppins", "Segoe UI", Arial, Helvetica, sans-serif;
      background: #0f172a;
      color: #e0f2fe;
      min-height: 100vh;
      width: 100vw;
      padding: 70px 20px 40px;
      max-width: 720px;
      margin: 0 auto;
      user-select: text;
      transition: background 0.3s, color 0.3s;
    }
    @media (max-width: 768px) {
      body {
        padding: 65px 16px 30px;
        max-width: 94vw;
      }
    }
    h1 {
      font-weight: 700;
      color: #60a5fa;
      text-align: center;
      font-size: 2.4rem;
      margin-bottom: 1.5rem;
      text-shadow: 0 0 12px #60a5fa88;
    }
    .social-list {
      display: flex;
      flex-direction: column;
      gap: 30px;
      margin: 42px auto 32px auto;
      max-width: 440px;
      width: 100%;
      align-items: center;
      justify-content: center;
    }
    .social-item {
      display: flex;
      align-items: center;
      gap: 20px;
      background: #182338;
      border-radius: 16px;
      padding: 18px 28px;
      font-size: 1.17rem;
      width: 100%;
      box-shadow: 0 3px 12px #60a5fa1a;
      transition: background 0.17s;
    }
    .social-item:hover,
    .social-item:focus-within {
      background: #213967;
    }
    .social-icon {
      width: 38px;
      height: 38px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 50%;
      background: linear-gradient(120deg, #60a5fa 60%, #a78bfa 100%);
      box-shadow: 0 2px 7px #60a5fa3a;
      flex-shrink: 0;
      transition: background 0.17s;
    }
    .social-item:hover .social-icon {
      background: linear-gradient(120deg, #22d3ee 60%, #c026d3 100%);
    }
    .social-link {
      color: #e0f2fe;
      font-weight: 600;
      font-size: 1.07rem;
      text-decoration: none;
      letter-spacing: 0.04em;
      transition: color 0.12s;
      word-break: break-word;
    }
    .social-link:hover,
    .social-link:focus {
      color: #a78bfa;
      text-decoration: underline;
      outline: none;
    }
    footer {
      text-align: center;
      padding: 20px 10px 40px;
      color: #475569;
      font-size: 0.9rem;
      user-select: none;
    }
    footer a {
      color: #60a5fa;
      text-decoration: underline;
      font-weight: 600;
    }
    footer a:hover {
      color: #22d3ee;
    }

    header {
      background: #182338;
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      min-height: 50px;
      box-shadow: 0 2px 17px #10162325;
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 0 16px;
      font-family: "Poppins", Arial, sans-serif;
      font-size: 1.02rem;
      user-select: none;
      z-index: 2000;
      transition: box-shadow 0.23s;
    }
    body.light-theme header {
      background: #eaf0fb;
      color: #222c3b;
    }
    .header-inner {
      display: flex;
      align-items: center;
      justify-content: space-between;
      width: 100%;
      max-width: 720px;
      margin: 0 auto;
      min-height: 50px;
      font-size: 1.02rem;
      font-family: "Poppins", Arial, sans-serif;
      position: relative;
      z-index: 1;
    }
    .logo-container {
      display: flex;
      align-items: center;
      gap: 8px;
      flex-shrink: 0;
    }
    .logo-container img {
      height: 25px;
      animation: float 3.3s ease-in-out infinite;
      display: block;
      user-select: none;
    }
    @keyframes float {
      0%,
      100% {
        transform: translateY(0);
      }
      50% {
        transform: translateY(-4px);
      }
    }
    .logo-text {
      font-family: "Orbitron", Arial, Helvetica, sans-serif;
      font-size: 1.02rem;
      color: #60a5fa;
      text-shadow: 0 0 7px #60a5fa74;
      font-weight: 800;
      letter-spacing: 0.055em;
      margin-left: 2px;
      user-select: none;
    }
    body.light-theme .logo-text {
      color: #1d4ed8;
      text-shadow: 0 0 8px #60a5fa60;
    }
    .menu-btn {
      font-size: 1.5rem;
      cursor: pointer;
      display: flex;
      align-items: center;
      min-width: 38px;
      height: 36px;
      z-index: 3;
      color: #80caff;
      outline: none;
      border: none;
      background: none;
      border-radius: 9px;
      transition: background 0.16s, transform 0.2s cubic-bezier(0.4, 0, 0.2, 1);
      position: relative;
      user-select: none;
      -webkit-tap-highlight-color: transparent;
    }
    .menu-btn:active {
      background: #20325c;
      transform: scale(0.93);
    }
    .menu-btn .notif-badge {
      background: linear-gradient(105deg, #f87171 65%, #fb923c 110%);
      color: white;
      font-weight: 700;
      min-width: 12px;
      height: 12px;
      padding: 0 6px;
      font-size: 12px;
      border-radius: 50%;
      display: flex;
      justify-content: center;
      align-items: center;
      text-align: center;
      position: absolute;
      top: 1px;
      right: 1px;
      border: 1px solid #182338;
      box-shadow: 0 2px 6px #ef444488;
      font-family: "Orbitron", sans-serif;
      user-select: none;
      z-index: 10;
      pointer-events: none;
    }

    .menu-dropdown {
      position: fixed;
      top: 0;
      right: -100%;
      height: 100vh;
      width: 220px;
      background: rgba(21, 33, 58, 0.97);
      box-shadow: -4px 0 26px rgba(0, 0, 0, 0.77);
      display: flex;
      flex-direction: column;
      padding-top: 54px;
      padding-bottom: 22px;
      box-sizing: border-box;
      transition: right 0.31s cubic-bezier(0.65, 0.01, 0.32, 1.03);
      z-index: 2500;
      font-family: "Poppins", Arial, sans-serif;
      font-weight: 600;
      font-size: 0.85rem;
      overflow-y: auto;
      max-height: 100vh;
    }
    body.light-theme .menu-dropdown {
      background: rgba(234, 240, 251, 0.94);
      color: #1e293b;
      box-shadow: -4px 0 24px rgba(16, 24, 39, 0.09);
    }
    header.expanded .menu-dropdown {
      right: 0;
    }
    .menu-dropdown .close-btn {
      position: absolute;
      left: 11px;
      top: 13px;
      background: transparent;
      border: none;
      cursor: pointer;
      padding: 0;
      outline: none;
      z-index: 2600;
      width: 30px;
      height: 30px;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: transform 0.2s ease;
      color: #60a5fa;
      user-select: none;
      -webkit-tap-highlight-color: transparent;
    }
    body.light-theme .menu-dropdown .close-btn {
      color: #2563eb;
    }
    .menu-dropdown .close-btn:hover,
    .menu-dropdown .close-btn:focus {
      color: #a78bfa;
      transform: scale(1.22);
    }
    .menu-dropdown .close-btn svg {
      width: 22px;
      height: 22px;
      stroke: currentColor;
      stroke-width: 2.5;
      stroke-linecap: round;
      stroke-linejoin: round;
    }
    .menu-dropdown a {
      color: #60a5fa;
      padding: 13px 17px 13px 46px;
      text-decoration: none;
      border-bottom: 2px solid #20325c;
      display: flex;
      align-items: center;
      gap: 15px;
      background: none;
      transition: background 0.13s, color 0.13s, padding-left 0.11s, transform 0.16s;
      position: relative;
      letter-spacing: 0.02em;
      user-select: none;
      font-weight: 600;
      font-size: 0.85rem;
      will-change: transform;
    }
    body.light-theme .menu-dropdown a {
      color: #2563eb;
      border-bottom: 1px solid #bfdbfe;
    }
    .menu-dropdown a:hover,
    .menu-dropdown a:focus {
      background: #213967;
      color: #fff;
      padding-left: 51px;
      outline: none;
      transform: scale(1.05) translateX(-2px);
    }
    body.light-theme .menu-dropdown a:hover,
    body.light-theme .menu-dropdown a:focus {
      background: #dbeafe;
      color: #1e293b;
    }
    .menu-dropdown a:active {
      background: #09196a;
      color: #fbbf24;
      transform: scale(0.97);
    }
    body.light-theme .menu-dropdown a:active {
      background: #dbeafe;
      color: #eab308;
    }
    .menu-dropdown a .icon {
      display: inline-flex;
      width: 22px;
      height: 22px;
      position: absolute;
      left: 15px;
      top: 50%;
      transform: translateY(-50%);
      fill: #60a5fa;
      filter: drop-shadow(0 1px 6px #60a5fa66);
      transition: fill 0.13s, filter 0.11s;
    }
    body.light-theme .menu-dropdown a .icon {
      fill: #2563eb;
    }
    .menu-dropdown a:hover .icon,
    .menu-dropdown a:focus .icon {
      fill: #fff;
      filter: drop-shadow(0 2px 8px #fff4);
    }
    body.light-theme .menu-dropdown a:hover .icon,
    body.light-theme .menu-dropdown a:focus .icon {
      fill: #1e293b;
    }
    .menu-dropdown .notif-badge {
      position: static;
      margin-left: 7px;
      box-shadow: none;
      border: none;
      font-weight: 700;
      font-size: 13px;
      min-width: 22px;
      height: 18px;
      background: linear-gradient(120deg, #fae024 70%, #f87171 100%);
      color: #222b3a;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      font-family: "Orbitron", sans-serif;
      border-radius: 7px;
    }

    @keyframes notifpop {
      0% {
        transform: scale(1);
      }
      50% {
        transform: scale(1.18) rotate(-3deg);
      }
      100% {
        transform: scale(1) rotate(0deg);
      }
    }
  </style>
</head>
<body>
  <header id="mainHeader" role="banner">
    <div class="header-inner">
      <div class="logo-container">
        <img src="https://firebasestorage.googleapis.com/v0/b/sharky-chat-007.firebasestorage.app/o/gc-logo.png?alt=media&token=ddfe6e46-7351-4a07-8140-ea702b1bd823" height="25" alt="Sharky Logo" />
        <div class="logo-text">SHARKY CHAT</div>
      </div>
      <button class="menu-btn" id="menuBtn" type="button" aria-label="Toggle menu" aria-expanded="false" aria-controls="mainNavigation">
        ☰<span class="notif-badge" id="menuNotif" style="display:none;">0</span>
      </button>
    </div>
    <nav class="menu-dropdown" id="mainNavigation" role="menu" aria-label="Main Navigation" aria-hidden="true">
      <button class="close-btn" aria-label="Close menu" title="Close menu" type="button">
        <svg viewBox="0 0 24 24" aria-hidden="true" focusable="false">
          <line x1="18" y1="6" x2="6" y2="18" />
          <line x1="6" y1="6" x2="18" y2="18" />
        </svg>
      </button>
      <a href="profile.html" role="menuitem"><span class="icon"><svg viewBox="0 0 32 32"><circle cx="16" cy="12" r="7"/><ellipse cx="16" cy="23.5" rx="12" ry="6.5"/></svg></span>Profile</a>
      <a href="chatrooms.html" role="menuitem"><span class="icon"><svg viewBox="0 0 32 32"><rect x="2" y="8" width="28" height="16" rx="5"/><rect x="12" y="6" width="8" height="4" rx="2"/><circle cx="7" cy="12" r="2"/><circle cx="25" cy="12" r="2"/></svg></span>Chat Rooms</a>
      <a href="friends.html" role="menuitem"><span class="icon"><svg viewBox="0 0 32 32"><circle cx="10" cy="12" r="5"/><circle cx="22" cy="12" r="5"/><ellipse cx="16" cy="23" rx="12" ry="6"/></svg></span>Friends <span id="friends-notif" class="notif-badge" style="display:none;">0</span></a>
      <a href="add-friends.html" role="menuitem"><span class="icon"><svg viewBox="0 0 32 32"><circle cx="15" cy="13" r="7"/><rect x="23" y="19" width="9" height="3" rx="1.5"/><rect x="26" y="16" width="3" height="9" rx="1.5"/></svg></span>Add Friend</a>
      <a href="inbox.html" role="menuitem"><span class="icon"><svg viewBox="0 0 32 32"><rect x="4" y="8" width="24" height="16" rx="4"/><polyline points="4,8 16,18 28,8" fill="none" stroke="#60a5fa" stroke-width="2"/></svg></span>Messages <span id="messages-notif" class="notif-badge" style="display:none;">0</span></a>
      <a href="wallet.html" role="menuitem"><span class="icon"><svg viewBox="0 0 32 32"><rect x="4" y="10" width="24" height="12" rx="3"/><ellipse cx="24" cy="16" rx="2" ry="2"/><rect x="6" y="13" width="20" height="4" rx="2"/><circle cx="17" cy="16" r="2" fill="#fff"/></svg></span>Wallet</a>
      <a href="shop.html" role="menuitem"><span class="icon"><svg viewBox="0 0 32 32"><rect x="6" y="13" width="20" height="9" rx="3"/><rect x="12" y="7" width="8" height="6" rx="2"/><rect x="13" y="22" width="6" height="4" rx="2"/><circle cx="10" cy="26" r="2"/><circle cx="22" cy="26" r="2"/></svg></span>Shop</a>
      <a href="inventory.html" role="menuitem"><span class="icon"><svg viewBox="0 0 32 32"><rect x="7" y="10" width="18" height="12" rx="3"/><rect x="11" y="6" width="10" height="4" rx="2"/><rect x="13" y="22" width="6" height="4" rx="2"/><path d="M7 22h18"/><circle cx="16" cy="18" r="2"/></svg></span>Inventory</a>
      <a href="news.html" role="menuitem"><span class="icon"><svg viewBox="0 0 32 32"><rect x="5" y="7" width="22" height="18" rx="4"/><rect x="9" y="11" width="14" height="2" rx="1"/><rect x="9" y="16" width="8" height="2" rx="1"/><circle cx="10" cy="21" r="2"/><rect x="14" y="20" width="7" height="2" rx="1"/></svg></span>News</a>
      <a href="level.html" role="menuitem"><span class="icon"><svg viewBox="0 0 32 32"><path d="M16 5v17" stroke="#6699ff" stroke-width="2.5" stroke-linecap="round"/><circle cx="16" cy="26" r="5" fill="#38bdf8" stroke="#bae6fd" stroke-width="1.5"/><rect x="11" y="13" width="10" height="4" rx="2" fill="#bae6fd" /><rect x="13" y="8" width="6" height="3" rx="1.5" fill="#60a5fa"/></svg></span>Level</a>
      <a href="refer.html" role="menuitem"><span class="icon"><svg viewBox="0 0 32 32"><circle cx="16" cy="16" r="13" fill="#5eead4" /><path d="M22.5,14h-8.7l3-3m-2.8,8a3,3,0,1,0-3,-3" stroke="#262626" stroke-width="2.3" fill="none" stroke-linecap="round" stroke-linejoin="round"/></svg></span>Refer A Friend</a>
      <a href="verify-email.html" role="menuitem"><span class="icon"><svg viewBox="0 0 32 32"><rect x="5" y="8" width="22" height="16" rx="5"/><polyline points="5,8 16,18 27,8" fill="none" stroke="#2dd4bf" stroke-width="2"/><circle cx="16" cy="19" r="2.5"/></svg></span>Email Verification</a>
      <a href="help.html" role="menuitem"><span class="icon"><svg viewBox="0 0 32 32"><circle cx="16" cy="16" r="12" fill="none" stroke="#fbbf24" stroke-width="2"/><text x="16" y="20" text-anchor="middle" fill="#fbbf24" font-size="8" font-family="Orbitron">?</text></svg></span>Help</a>
      <a href="social-media.html" role="menuitem"><span class="icon"><svg viewBox="0 0 32 32"><circle cx="8" cy="12" r="3"/><circle cx="24" cy="12" r="3"/><circle cx="16" cy="22" r="3"/><line x1="8" y1="15" x2="16" y2="19" stroke="#60a5fa" stroke-width="2"/><line x1="24" y1="15" x2="16" y2="19" stroke="#60a5fa" stroke-width="2"/></svg></span>Social Media</a>
      <a href="#" id="themeSwitch" role="menuitem"><span class="icon"><svg viewBox="0 0 32 32"><circle cx="16" cy="16" r="12"/><path d="M16 4v8"/><circle cx="16" cy="16" r="5" fill="#fff"/></svg></span>Change Theme</a>
    </nav>
  </header>

  <main>
    <h1>Official Social Media Accounts</h1>
    <div class="social-list">
      <div class="social-item">
        <span class="social-icon" aria-label="Instagram">
          <svg viewBox="0 0 40 40" fill="white" width="30" height="30">
            <radialGradient id="grad" cx="50%" cy="50%" r="80%">
              <stop offset="0%" stop-color="#feda75"/>
              <stop offset="25%" stop-color="#fa7e1e"/>
              <stop offset="100%" stop-color="#d62976"/>
            </radialGradient>
            <circle cx="20" cy="20" r="20" fill="url(#grad)"/>
            <path d="M20 14.3a5.7 5.7 0 1 0 0 11.4 5.7 5.7 0 0 0 0-11.4zm0 9.4a3.7 3.7 0 1 1 0-7.4 3.7 3.7 0 0 1 0 7.4zm7-9.8a1.3 1.3 0 1 1-2.6 0 1.3 1.3 0 0 1 2.6 0z" fill="white"/>
          </svg>
        </span>
        <a class="social-link" href="https://www.instagram.com/sharkychatdotcom?igsh=MWpqcnZsaGhxb3gycA==" target="_blank" rel="noopener noreferrer">@sharkychatdotcom</a>
      </div>
    </div>
  </main>

  <footer>
    &copy; 2025 Sharky Chat. All rights reserved.
  </footer>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
  import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
  import {
    getFirestore,
    collection,
    query,
    where,
    onSnapshot,
    getDoc,
    doc,
    getDocs,
    updateDoc
  } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyBGfgy9OeMTJ__oOAFxoBW-eIOYlvhObZM",
    authDomain: "sharky-chat-007.firebaseapp.com",
    projectId: "sharky-chat-007",
    storageBucket: "sharky-chat-007.appspot.com",
    messagingSenderId: "637104796242",
    appId: "1:637104796242:web:74ac36b86af91be15ea58b",
    measurementId: "G-HT9T3P9KST",
  };

  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);
  const db = getFirestore(app);

  const menuNotif = document.getElementById("menuNotif");
  const friendsNotif = document.getElementById("friends-notif");
  const messagesNotif = document.getElementById("messages-notif");

  const headDrop = document.querySelector(".menu-btn");
  const mainHeader = document.getElementById("mainHeader");
  const closeBtn = document.querySelector(".menu-dropdown .close-btn");
  const themeSwitch = document.getElementById("themeSwitch");

  let theme = localStorage.getItem("theme") || "dark";
  if (theme === "light") document.body.classList.add("light-theme");

  themeSwitch.addEventListener("click", () => {
    document.body.classList.toggle("light-theme");
    theme = document.body.classList.contains("light-theme") ? "light" : "dark";
    localStorage.setItem("theme", theme);
    mainHeader.classList.remove("expanded");
  });

  headDrop.addEventListener("click", (e) => {
    const expanded = mainHeader.classList.toggle("expanded");
    headDrop.setAttribute("aria-expanded", expanded);
    e.stopPropagation();
  });

  closeBtn.addEventListener("click", (e) => {
    mainHeader.classList.remove("expanded");
    headDrop.setAttribute("aria-expanded", false);
    headDrop.focus();
    e.stopPropagation();
  });

  document.addEventListener("click", (e) => {
    if (
      !mainHeader.contains(e.target) &&
      !document.querySelector(".menu-dropdown").contains(e.target)
    ) {
      mainHeader.classList.remove("expanded");
      headDrop.setAttribute("aria-expanded", false);
    }
  });

  document.querySelector(".menu-dropdown").addEventListener("click", (e) => {
    if (e.target.tagName === "A") {
      mainHeader.classList.remove("expanded");
      headDrop.setAttribute("aria-expanded", false);
    }
  });

  function bumpBadge(el, number) {
    if (!el) return;
    el.style.animation = "";
    setTimeout(() => {
      el.style.animation = "notifpop .34s";
    }, 12);
  }

  async function updateActivePresence(uid) {
    if (!uid) return;
    try {
      await updateDoc(doc(db, "users", uid), { active: true, lastActive: Date.now() });
    } catch (e) {
      // ignore errors
    }
    window._presenceInterval && clearInterval(window._presenceInterval);
    window._presenceInterval = setInterval(async () => {
      try {
        await updateDoc(doc(db, "users", uid), { active: true, lastActive: Date.now() });
      } catch (e) {
        // ignore errors
      }
    }, 60000);
  }

  async function setupMenuNotifications(uid, username) {
    onSnapshot(
      query(
        collection(db, "friendRequests"),
        where("to", "==", uid),
        where("status", "==", "pending")
      ),
      (friendReqSnap) => {
        const frCount = friendReqSnap.size;
        friendsNotif.textContent = frCount > 99 ? "99+" : frCount;
        friendsNotif.style.display = frCount > 0 ? "inline-flex" : "none";
        bumpBadge(friendsNotif, frCount);

        const msgCount = parseInt(messagesNotif.dataset.count) || 0;
        const totalBadge = frCount + msgCount;
        menuNotif.textContent = totalBadge > 99 ? "99+" : totalBadge;
        menuNotif.style.display = totalBadge > 0 ? "inline-flex" : "none";
        bumpBadge(menuNotif, totalBadge);
      }
    );
  }

  async function setupMessageNotifications(uid, username) {
    const myFriendsDoc = await getDoc(doc(db, "friends", uid));
    if (!myFriendsDoc.exists()) return;
    const friends = Object.keys(myFriendsDoc.data() || {});
    if (friends.length === 0) {
      messagesNotif.textContent = "";
      messagesNotif.style.display = "none";
      return;
    }

    const usernamesData = {};
    const batchSize = 10;
    for (let i = 0; i < friends.length; i += batchSize) {
      const batch = friends.slice(i, i + batchSize);
      const qsnap = await getDocs(
        query(collection(db, "users"), where("__name__", "in", batch))
      );
      qsnap.forEach((docu) => {
        usernamesData[docu.id] = docu.data().username;
      });
    }

    if (messagesNotif._unsubAll) {
      messagesNotif._unsubAll.forEach((fn) => {
        try {
          fn();
        } catch {}
      });
    }
    messagesNotif._unsubAll = [];

    let unseenTracker = {};

    function updateBadges() {
      let totalUnseen = Object.values(unseenTracker).reduce((a, b) => a + b, 0);
      messagesNotif.dataset.count = totalUnseen;
      messagesNotif.textContent = totalUnseen > 99 ? "99+" : totalUnseen;
      messagesNotif.style.display = totalUnseen > 0 ? "inline-flex" : "none";
      bumpBadge(messagesNotif, totalUnseen);

      const frCount = parseInt(friendsNotif.textContent) || 0;
      const sum = frCount + totalUnseen;
      menuNotif.textContent = sum > 99 ? "99+" : sum;
      menuNotif.style.display = sum > 0 ? "inline-flex" : "none";
      bumpBadge(menuNotif, sum);
    }

    for (const fid of friends) {
      const friendUsername = usernamesData[fid];
      if (!friendUsername || friendUsername === username) continue;

      const chatId = [username, friendUsername].sort().join("_");

      const unsub = onSnapshot(
        query(
          collection(db, "personalMessages", chatId, "messages"),
          where("recipient", "==", username),
          where("seen", "==", false)
        ),
        (snap) => {
          let unseen = 0;
          snap.forEach((docu) => {
            if (docu.data().sender !== username) unseen++;
          });
          unseenTracker[chatId] = unseen;
          updateBadges();
        }
      );
      messagesNotif._unsubAll.push(unsub);
    }
  }

  onAuthStateChanged(auth, (user) => {
    if (!user) {
      return;
    }
    const uid = user.uid;
    const username = user.displayName || "";
    updateActivePresence(uid);
    window.addEventListener("beforeunload", () => {
      if (uid)
        updateDoc(doc(db, "users", uid), {
          active: false,
          lastActive: Date.now(),
        });
    });
    setupMenuNotifications(uid, username);
    setupMessageNotifications(uid, username);
  });
</script>

</body>
</html>
