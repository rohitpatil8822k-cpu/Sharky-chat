<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0, viewport-fit=cover" />
  <title>Sharky Inventory</title>
  <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;700;800&family=Orbitron:wght@400;700;900&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    :root {
      --primary: #00d4ff; --surface: #121826; --bg: #05070a;
      --border: rgba(255, 255, 255, 0.08); --text-main: #ffffff;
      --text-dim: #94a3b8; --gold: #fbbf24;
    }
    * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
    body { background-color: var(--bg); color: var(--text-main); font-family: 'Outfit', sans-serif; min-height: 100vh; display: flex; flex-direction: column; align-items: center; overflow-x: hidden; padding-top: 60px; }
    body.premium-theme { background: radial-gradient(circle at top, #1c180e 0%, #05070a 100%); }
    body.pro-theme { background: radial-gradient(circle at top, #0f172a 0%, #05070a 100%); }
    .inventory-container { width: 100%; max-width: 480px; padding: 20px 15px 100px; }
    .page-header { text-align: center; margin-bottom: 30px; }
    .page-title { font-family: 'Orbitron', sans-serif; font-size: 1.6rem; font-weight: 800; letter-spacing: 2px; text-transform: uppercase; color: #fff; }
    .page-subtitle { font-size: 0.7rem; color: var(--text-dim); letter-spacing: 1.2px; margin-top: 5px; font-weight: 700; }
    .inv-section { margin-bottom: 35px; }
    .section-label { font-size: 0.7rem; font-weight: 800; color: var(--primary); text-transform: uppercase; letter-spacing: 2px; margin-bottom: 15px; display: flex; align-items: center; gap: 8px; }
    .premium-theme .section-label { color: var(--gold); }
    .inv-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; }
    .item-card { background: var(--surface); border: 1px solid var(--border); border-radius: 18px; padding: 10px 6px; display: flex; flex-direction: column; align-items: center; text-align: center; position: relative; transition: transform 0.2s; }
    .item-card.equipped { border-color: var(--primary); background: rgba(0, 212, 255, 0.08); }
    .premium-theme .item-card.equipped { border-color: var(--gold); background: rgba(251, 191, 36, 0.08); }
    .item-card img { width: 100%; aspect-ratio: 1/1; border-radius: 12px; object-fit: cover; margin-bottom: 8px; }
    .item-name { font-size: 0.6rem; font-weight: 600; color: #fff; margin-bottom: 8px; height: 28px; overflow: hidden; line-height: 1.2; }
    .action-btn { width: 100%; padding: 7px; border-radius: 8px; border: none; font-size: 0.6rem; font-weight: 800; cursor: pointer; text-transform: uppercase; font-family: 'Orbitron', sans-serif; }
    .equip-btn { background: var(--primary); color: #000; }
    .remove-btn { background: rgba(239, 68, 68, 0.15); color: #ef4444; border: 1px solid rgba(239, 68, 68, 0.3); }
    .status-badge { position: absolute; top: 5px; right: 5px; background: var(--primary); color: #000; font-size: 0.45rem; padding: 2px 5px; border-radius: 4px; font-weight: 900; z-index: 2; font-family: 'Orbitron', sans-serif; }
    .premium-theme .status-badge { background: var(--gold); }
    #savePopup { position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%) scale(0.85); background: rgba(7, 8, 10, 0.98); backdrop-filter: blur(20px); border: 1px solid var(--border); padding: 25px; border-radius: 25px; z-index: 10005; text-align: center; width: 80%; max-width: 320px; opacity: 0; pointer-events: none; transition: 0.3s cubic-bezier(0.16, 1, 0.3, 1); }
    #savePopup.show { opacity: 1; pointer-events: auto; transform: translate(-50%, -50%) scale(1); }
    .success-icon { width: 50px; height: 50px; background: var(--primary); color: #000; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 12px; font-size: 1.2rem; }
    .premium-theme .success-icon { background: var(--gold); }
    .empty-msg { grid-column: span 3; padding: 20px; text-align: center; color: var(--text-dim); font-size: 0.8rem; }
  </style>
</head>
<body id="mainBody">

  <script src="header.js"></script>

  <div id="savePopup">
    <div class="success-icon" id="popIcon"><i class="fa-solid fa-check"></i></div>
    <div id="popTitle" style="font-weight: 800; font-size: 1rem; color: #fff; margin-bottom: 5px; font-family: 'Orbitron';">SYSTEM UPDATE</div>
    <div id="popMsg" style="font-weight: 400; font-size: 0.8rem; color: var(--text-dim);">Profile data synchronized.</div>
  </div>

  <div class="inventory-container">
    <div class="page-header">
      <div class="page-title">Inventory</div>
      <div class="page-subtitle" id="tierLabel">SYNCING ASSETS...</div>
    </div>

    <section class="inv-section">
      <div class="section-label"><i class="fa-solid fa-image"></i> Owned Banners</div>
      <div id="invBanner" class="inv-grid"></div>
    </section>

    <section class="inv-section">
      <div class="section-label"><i class="fa-solid fa-award"></i> My Badges</div>
      <div id="invBadges" class="inv-grid"></div>
    </section>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
    import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
    import { getFirestore, doc, getDoc, setDoc, onSnapshot } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyBGfgy9OeMTJ__oOAFxoBW-eIOYlvhObZM",
      authDomain: "sharky-chat-007.firebaseapp.com",
      projectId: "sharky-chat-007",
      storageBucket: "sharky-chat-007.appspot.com",
      messagingSenderId: "637104796242",
      appId: "1:637104796242:web:74ac36b86af91be15ea58b",
      measurementId: "G-HT9T3P9KST",
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const auth = getAuth(app);

    const itemsMeta = {
      banner: {
        "banner_stars_profile": { n: "Stars Night", src: "https://user-gen-media-assets.s3.amazonaws.com/gpt4o_images/94c0fcfa-2a7a-46f1-ad8d-9ae08a932228.png" },
        "banner_cute_rabbit": { n: "Cute Rabbit", src: "https://user-gen-media-assets.s3.amazonaws.com/gpt4o_images/c4c60231-2b74-427d-8037-98f1b33227f1.png" },
        "banner_peaceful_house_3d": { n: "Modern Villa", src: "https://user-gen-media-assets.s3.amazonaws.com/gpt4o_images/3baf3830-1a64-425c-bd6f-905bacbc84ad.png" },
        "banner_4d_illusion": { n: "Abstract 4D", src: "https://user-gen-media-assets.s3.amazonaws.com/gpt4o_images/0704da65-dc4f-4ece-adbc-cd598182010c.png" },
        "banner_3d_luxury": { n: "Luxury Gold", src: "https://user-gen-media-assets.s3.amazonaws.com/gpt4o_images/5d228e0c-1e37-4101-90e4-28313586a6af.png" },
        "banner_3d_moon": { n: "Moonlight", src: "https://user-gen-media-assets.s3.amazonaws.com/gpt4o_images/d185a9a8-660f-4396-9925-b3760299e111.png" },
        "banner_3d_gaming": { n: "Neon Gamer", src: "https://user-gen-media-assets.s3.amazonaws.com/gpt4o_images/86b48c74-56b9-4e3d-b82c-4be753dd9234.png" },
        "banner_cartoon_one_eyed_devil": { n: "Little Devil", src: "https://user-gen-media-assets.s3.amazonaws.com/gpt4o_images/c33cf83a-151b-4f56-ad81-5b2f2c4b9164.png" },
        "banner_bmw_headlight_evil": { n: "Sport Car", src: "https://user-gen-media-assets.s3.amazonaws.com/gpt4o_images/e3a07e8f-23af-42d5-9a5d-03f4f768ec76.png" },
        "banner_cartoon_turtle": { n: "Sea Turtle", src: "https://user-gen-media-assets.s3.amazonaws.com/gpt4o_images/73c882c5-e531-4b01-a356-75fdc5e4f822.png" },
        "banner_3d_rain": { n: "Rainy Day", src: "https://user-gen-media-assets.s3.amazonaws.com/gpt4o_images/09250fbd-e0a9-4861-9251-8033325be157.png" }
      },
      badge: {
        "badge_star_light": { n: "Star", src: "https://user-gen-media-assets.s3.amazonaws.com/gpt4o_images/cb7afe60-1c8e-4af6-8780-01856f63b51d.png" },
        "badge_moon_dark": { n: "Moon", src: "https://user-gen-media-assets.s3.amazonaws.com/gpt4o_images/60a43f65-1ab7-4923-8788-758778130a22.png" },
        "badge_rising_star": { n: "Riser", src: "https://user-gen-media-assets.s3.amazonaws.com/gpt4o_images/43fb251c-b5e8-4541-a786-d91e060eb7f0.png" },
        "badge_luxury": { n: "Elite", src: "https://user-gen-media-assets.s3.amazonaws.com/gpt4o_images/23b9ac5c-faaf-4d14-ad52-65aab320e878.png" },
        "badge_legendary": { n: "Legend", src: "https://user-gen-media-assets.s3.amazonaws.com/gpt4o_images/85b7077f-5e80-42e1-890f-ec78df6afd0e.png" },
        "badge_warrior": { n: "Warrior", src: "https://user-gen-media-assets.s3.amazonaws.com/gpt4o_images/8315ccb8-4f68-4dc9-b1c9-225b62ed2a87.png" },
        "badge_wolf": { n: "Alpha", src: "https://user-gen-media-assets.s3.amazonaws.com/gpt4o_images/94674004-81f1-4aa5-afe2-15c097b29a76.png" },
        "badge_lion": { n: "King", src: "https://user-gen-media-assets.s3.amazonaws.com/gpt4o_images/f026bd24-7f5b-44d8-9312-a190d6d30933.png" },
        "badge_king": { n: "Emperor", src: "https://user-gen-media-assets.s3.amazonaws.com/gpt4o_images/a07d8670-6f91-43b1-884e-79a347c3fda0.png" }
      }
    };

    let uid, equipped = {}, currentPlan = "free", purchased = [];

    onAuthStateChanged(auth, async user => {
      if(!user) return;
      uid = user.uid;
      
      onSnapshot(doc(db, "users", uid), (uSnap) => {
        if(!uSnap.exists()) return;
        currentPlan = (uSnap.data().membershipPlan || "free").toLowerCase();
        document.body.classList.remove("premium-theme", "pro-theme");
        if(currentPlan === "premium") document.body.classList.add("premium-theme");
        if(currentPlan === "pro") document.body.classList.add("pro-theme");
        document.getElementById("tierLabel").textContent = `${currentPlan.toUpperCase()} TIER ACCESS`;
      });

      // Updated Logic: Inventories collection se UID document fetch ho raha hai
      onSnapshot(doc(db, "inventories", uid), (invSnap) => {
        purchased = [];
        if (invSnap.exists()) {
          const data = invSnap.data();
          // Check karke array mein push kar rahe hain agar value true hai
          Object.keys(data).forEach(key => {
            if(data[key] === true) purchased.push(key);
          });
        }
        loadInventory();
      });
    });

    async function loadInventory() {
      onSnapshot(doc(db, "equipped", uid), (eqSnap) => {
        equipped = eqSnap.exists() ? eqSnap.data() : {};
        renderGrid("invBanner", itemsMeta.banner, "banner");
        renderGrid("invBadges", itemsMeta.badge, "badge");
      });
    }

    function renderGrid(containerId, meta, type) {
      const container = document.getElementById(containerId);
      container.innerHTML = "";
      
      const owned = Object.entries(meta).filter(([id]) => purchased.includes(id));

      if(owned.length === 0) {
        container.innerHTML = `<div class="empty-msg">No ${type}s owned. Visit shop to buy!</div>`;
        return;
      }

      owned.forEach(([id, data]) => {
        const isEquipped = (type === "banner") 
          ? (equipped.banner === id) 
          : (equipped.badge1 === id || equipped.badge2 === id || equipped.badge3 === id);
          
        const card = document.createElement("div");
        card.className = `item-card ${isEquipped ? 'equipped' : ''}`;
        card.innerHTML = `
          ${isEquipped ? '<div class="status-badge">ACTIVE</div>' : ''}
          <img src="${data.src}">
          <div class="item-name">${data.n}</div>
          <button class="action-btn ${isEquipped ? 'remove-btn' : 'equip-btn'}">${isEquipped ? 'REMOVE' : 'EQUIP'}</button>
        `;
        card.querySelector('button').onclick = () => toggleItem(id, type, isEquipped);
        container.appendChild(card);
      });
    }

    function showPopup(title, msg, type="success") {
      const pop = document.getElementById("savePopup");
      document.getElementById("popTitle").textContent = title;
      document.getElementById("popMsg").textContent = msg;
      const icon = document.getElementById("popIcon");
      
      if(type === "error") {
        icon.style.background = "#ef4444";
        icon.innerHTML = '<i class="fa-solid fa-xmark"></i>';
      } else {
        icon.style.background = currentPlan === "premium" ? "var(--gold)" : "var(--primary)";
        icon.innerHTML = '<i class="fa-solid fa-check"></i>';
      }
      
      pop.classList.add("show");
      setTimeout(() => pop.classList.remove("show"), 1800);
    }

    window.toggleItem = async (id, type, isEquipped) => {
      let updates = { ...equipped };
      if(type === "banner") {
        updates.banner = isEquipped ? null : id;
      } else {
        const slots = [equipped.badge1, equipped.badge2, equipped.badge3];
        if(isEquipped) {
          if(equipped.badge1 === id) updates.badge1 = null;
          else if(equipped.badge2 === id) updates.badge2 = null;
          else if(equipped.badge3 === id) updates.badge3 = null;
        } else {
          const max = currentPlan === "premium" ? 3 : (currentPlan === "pro" ? 2 : 1);
          const activeCount = slots.filter(s => s).length;
          if(activeCount >= max) {
            showPopup("LIMIT REACHED", `Current plan supports max ${max} badge(s).`, "error");
            return;
          }
          if(!equipped.badge1) updates.badge1 = id;
          else if(!equipped.badge2) updates.badge2 = id;
          else if(!equipped.badge3) updates.badge3 = id;
        }
      }
      
      try {
        await setDoc(doc(db, "equipped", uid), updates, { merge: true });
        showPopup("SUCCESS", isEquipped ? "Item removed." : "Item equipped!");
      } catch (err) {
        showPopup("ERROR", "Sync failed.", "error");
      }
    };
  </script>
</body>
</html>